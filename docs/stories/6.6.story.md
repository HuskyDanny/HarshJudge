# Story 6.6: Skill File Consolidation

## Status

Done

## Story

**As a** HarshJudge user,
**I want** fewer, more comprehensive skill files,
**so that** AI agents have clearer guidance without file-hopping.

## Acceptance Criteria

1. `SKILL.md` updated to include:
   - Agent spawning pattern (from `agent-pattern.md`)
   - Core principles and workflow overview
   - Quick reference for all MCP tools
2. `run.md` updated to include:
   - Playwright tool usage (from `playwright-tools.md`)
   - Step-based execution workflow
   - Evidence capture patterns
3. Delete redundant files:
   - `references/agent-pattern.md`
   - `references/playwright-tools.md`
4. Update `create.md` to call `createScenario` MCP tool
5. Remaining skill structure:
   ```
   skills/harshjudge/
   ├── SKILL.md              # Main entry, includes agent patterns
   ├── assets/
   │   └── prd.md            # PRD template
   └── references/
       ├── setup.md          # Project initialization
       ├── create.md         # Scenario creation (uses createScenario)
       ├── run.md            # Step execution (includes Playwright tools)
       ├── status.md         # Status checking
       └── iterate.md        # Scenario editing
   ```

## Tasks / Subtasks

- [x] Task 1: Update SKILL.md with agent patterns (AC: 1)
  - [x] Open `skills/harshjudge/SKILL.md`
  - [x] Add "Agent Spawning Pattern" section (content from agent-pattern.md)
  - [x] Add "Token Optimization" subsection
  - [x] Update "Core Principles" to remove iterations.md reference
  - [x] Update "Project Structure" to show new steps/ layout
  - [x] Update MCP tools quick reference:
    - Add `createScenario` (replaces saveScenario)
    - Add `completeStep` (new)
    - Add `toggleStar` (new)
    - Update `recordEvidence` (now takes stepId)
  - [x] Update workflow table to reference updated files

- [x] Task 2: Update run.md with Playwright tools (AC: 2)
  - [x] Open `skills/harshjudge/references/run.md`
  - [x] Add "Playwright MCP Tools Reference" section (content from playwright-tools.md)
  - [x] Include element reference format (ref=eN)
  - [x] Include common tool patterns (navigate, click, type, screenshot)
  - [x] Update workflow for step-based execution (from Story 6.5)
  - [x] Update evidence paths for per-step structure

- [x] Task 3: Delete redundant reference files (AC: 3)
  - [x] Delete `skills/harshjudge/references/agent-pattern.md`
  - [x] Delete `skills/harshjudge/references/playwright-tools.md`
  - [x] Verify no broken references in other skill files

- [x] Task 4: Delete iterations.md asset (AC: 1)
  - [x] Delete `skills/harshjudge/assets/iterations.md`
  - [x] Update any references in other skill files

- [x] Task 5: Update create.md for createScenario (AC: 4)
  - [x] Open `skills/harshjudge/references/create.md`
  - [x] Replace `saveScenario` tool usage with `createScenario`
  - [x] Update input format to use steps array instead of content string
  - [x] Update example with step-based structure
  - [x] Add note about starred field

- [x] Task 6: Update setup.md for new structure (AC: 5)
  - [x] Open `skills/harshjudge/references/setup.md`
  - [x] Update project structure diagram to show prd.md and steps/
  - [x] Update initProject result to show prdPath
  - [x] Remove references to iterations.md

- [x] Task 7: Update status.md for starred filter (AC: 1)
  - [x] Open `skills/harshjudge/references/status.md`
  - [x] Add `starredOnly` parameter usage
  - [x] Update example responses to include starred field

- [x] Task 8: Update iterate.md for step-based editing (AC: 5)
  - [x] Open `skills/harshjudge/references/iterate.md`
  - [x] Update to edit individual step files
  - [x] Update evidence paths for per-step structure
  - [x] Remove iterations.md references

- [x] Task 9: Verify final skill structure (AC: 5)
  - [x] Confirm file tree matches AC 5
  - [x] Test that skill activates correctly in Claude Code
  - [x] Verify all internal references work

## Dev Notes

### Architecture References

**Target Skill Structure** [Source: architecture/11-unified-project-structure.md]
```
skills/harshjudge/                   # Claude skill files (CONSOLIDATED)
├── SKILL.md                  # Main entry (includes agent patterns)
├── assets/
│   └── prd.md                # PRD template for initProject
└── references/
    ├── setup.md              # Project initialization
    ├── create.md             # Scenario creation (uses createScenario)
    ├── run.md                # Step execution (includes Playwright tools)
    ├── status.md             # Status checking
    └── iterate.md            # Scenario editing
```

**Files to Delete** [Source: architecture/11-unified-project-structure.md#Removed Files]
| File | Reason |
|------|--------|
| `skills/harshjudge/references/agent-pattern.md` | Embedded in SKILL.md |
| `skills/harshjudge/references/playwright-tools.md` | Embedded in run.md |
| `skills/harshjudge/assets/iterations.md` | No longer needed |

**Content to Embed in SKILL.md**:
From agent-pattern.md:
- Agent spawning with Task tool
- Token optimization rationale
- Prompt templates for inspection tools
- Snapshot file naming conventions

**Content to Embed in run.md**:
From playwright-tools.md:
- Playwright MCP tool reference table
- Element reference format (ref=eN annotations)
- Common patterns: navigate, click, type, fill_form
- Screenshot and evidence capture

### File Locations

| Current File | Action |
|--------------|--------|
| `skills/harshjudge/SKILL.md` | Update (embed agent-pattern content) |
| `skills/harshjudge/references/run.md` | Update (embed playwright-tools content) |
| `skills/harshjudge/references/create.md` | Update (use createScenario) |
| `skills/harshjudge/references/setup.md` | Update (new structure) |
| `skills/harshjudge/references/status.md` | Update (starredOnly param) |
| `skills/harshjudge/references/iterate.md` | Update (step-based editing) |
| `skills/harshjudge/references/agent-pattern.md` | DELETE |
| `skills/harshjudge/references/playwright-tools.md` | DELETE |
| `skills/harshjudge/assets/iterations.md` | DELETE |

### Key Implementation Notes

1. **Embedding vs Linking**: The goal is to reduce file-hopping. Embed content directly rather than linking to other files. AI agents work better with self-contained documents.

2. **SKILL.md Size**: After embedding agent-pattern content, SKILL.md will be larger. This is acceptable — the file is read once at skill activation, and comprehensive content reduces follow-up reads.

3. **run.md Playwright Section**: Include the essential Playwright tools reference but keep it practical. Don't need full MCP documentation — just the patterns HarshJudge uses:
   - `browser_navigate` — Go to URL
   - `browser_snapshot` — Get element refs
   - `browser_click` — Click element by ref
   - `browser_type` — Type into input
   - `browser_take_screenshot` — Capture evidence
   - `browser_console_messages` — Get logs

4. **createScenario in create.md**: The big change is from `saveScenario` (markdown blob) to `createScenario` (structured steps). Include a clear example:
   ```json
   {
     "slug": "login-flow",
     "title": "User Login Flow",
     "steps": [
       {
         "title": "Navigate to login page",
         "actions": "1. Go to /login\n2. Wait for page load",
         "expectedOutcome": "Login form is visible"
       }
     ],
     "tags": ["auth"],
     "starred": true
   }
   ```

5. **No Breaking Changes to Skill Activation**: The SKILL.md frontmatter (name, description) must remain valid. Only the content body changes.

### Testing

This story is primarily documentation changes. Testing approach:

1. **Skill Activation Test**:
   - Open Claude Code in a test project
   - Verify `/harshjudge:setup` activates skill
   - Verify skill description appears correctly

2. **Reference Verification**:
   - Grep for deleted file references
   - Ensure no broken links in skill files

3. **Content Verification**:
   - Verify agent-pattern content is in SKILL.md
   - Verify Playwright tools are in run.md
   - Verify createScenario is in create.md

**Verification Commands**:
```bash
# Check for broken references
grep -r "agent-pattern.md" skills/
grep -r "playwright-tools.md" skills/
grep -r "iterations.md" skills/

# Verify files deleted
ls skills/harshjudge/references/agent-pattern.md  # Should not exist
ls skills/harshjudge/references/playwright-tools.md  # Should not exist
ls skills/harshjudge/assets/iterations.md  # Should not exist
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-18 | 1.0 | Initial story draft | SM Agent (Bob) |
