# Story 3.6: Implement Scenario List Panel

## Status

Done

## Story

**As a** dashboard user,
**I want** to see all scenarios for a selected project with their status,
**so that** I can identify which scenarios are passing or failing.

## Acceptance Criteria

1. Panel displays scenarios for currently selected project
2. Each scenario shows: title, last run status, last run time (relative)
3. Status badges: ✓ Pass (green), ✗ Fail (red), — Never Run (gray)
4. Scenarios sorted by last run time (most recent first)
5. Clicking scenario selects it and populates Detail Panel
6. Scenario tags displayed as small chips below title
7. Quick stats shown: total runs, pass rate percentage
8. Empty state when project has no scenarios
9. Scenario list updates live when new runs complete

## Tasks / Subtasks

- [x] Task 1: Reused StatusBadge component from Story 3.5 (AC: 2, 3)
  - [x] StatusBadge already handles pass/fail/never_run states
  - [x] Integrated into ScenarioListPanel list items

- [x] Task 2: Enhanced relative time display utility (AC: 2)
  - [x] Updated `src/lib/parsers.ts` formatRelativeTime function
  - [x] Handles null, invalid dates, future dates
  - [x] Returns "Yesterday", weeks, months formats

- [x] Task 3: Create TagChip component (AC: 6)
  - [x] Created `src/components/common/TagChip.tsx`
  - [x] Small pill-style badge for scenario tags
  - [x] sm/md size variants

- [x] Task 4: Create ScenarioListPanel component (AC: 1, 4, 5, 8)
  - [x] Created `src/components/panels/ScenarioListPanel.tsx`
  - [x] Props: scenarios, selectedScenario, onSelect, loading, error
  - [x] Sorted by lastRun (most recent first, null last)
  - [x] Empty state with EmptyState component
  - [x] Tags with +N overflow indicator

- [x] Task 5: Integrate with App.tsx (AC: 1, 5, 9)
  - [x] Replaced ScenarioListPlaceholder with ScenarioListPanel
  - [x] Connected useScenarios hook with selectedProject
  - [x] Selection state wired up
  - [x] Live updates via FileWatcherContext

- [x] Task 6: Write tests (AC: all)
  - [x] Created `tests/components/ScenarioListPanel.test.tsx` (20 tests)
  - [x] Created `tests/components/TagChip.test.tsx` (8 tests)
  - [x] Created `tests/lib/formatRelativeTime.test.ts` (22 tests)
  - [x] Total: 122 tests passing

## Dev Notes

### Previous Story Insights
- Story 3.5 created StatusBadge component (reuse for scenario status)
- Story 3.2 created useScenarios hook and ScenarioSummary type
- Story 3.4 created EmptyState component
- App.tsx currently has ScenarioListPlaceholder with sample data

### Data Structure
[Source: Story 3.2 - DataService.ts]

```typescript
interface ScenarioSummary {
  slug: string;
  title: string;
  tags: string[];
  lastResult: 'pass' | 'fail' | null;
  lastRun: string | null; // ISO timestamp
  totalRuns: number;
  passRate: number; // 0-100
}
```

### Component Architecture
[Source: architecture/9-frontend-architecture.md]

```typescript
// packages/ux/src/components/panels/ScenarioListPanel.tsx
import { type FC, useMemo } from 'react';
import { type ScenarioSummary } from '@/services/DataService';
import { StatusBadge } from '../common/StatusBadge';
import { TagChip } from '../common/TagChip';
import { EmptyState, DocumentIcon } from '../common/EmptyState';
import { formatRelativeTime } from '@/lib/formatRelativeTime';

interface ScenarioListPanelProps {
  scenarios: ScenarioSummary[];
  selectedScenario: string | null;
  onSelect: (scenarioSlug: string) => void;
  loading?: boolean;
  error?: string | null;
}

export const ScenarioListPanel: FC<ScenarioListPanelProps> = ({
  scenarios,
  selectedScenario,
  onSelect,
  loading,
  error,
}) => {
  // Sort by last run (most recent first), null values last
  const sortedScenarios = useMemo(() => {
    return [...scenarios].sort((a, b) => {
      if (!a.lastRun && !b.lastRun) return 0;
      if (!a.lastRun) return 1;
      if (!b.lastRun) return -1;
      return new Date(b.lastRun).getTime() - new Date(a.lastRun).getTime();
    });
  }, [scenarios]);

  if (loading) {
    return <LoadingState />;
  }

  if (error) {
    return <EmptyState title="Error" description={error} />;
  }

  if (scenarios.length === 0) {
    return (
      <EmptyState
        icon={<DocumentIcon />}
        title="No scenarios"
        description="Create scenarios with /harshjudge:init"
      />
    );
  }

  return (
    <div className="flex flex-col h-full">
      <header className="p-3 border-b border-gray-700">
        <h2 className="text-sm font-medium text-gray-400">
          Scenarios ({scenarios.length})
        </h2>
      </header>
      <ul className="flex-1 overflow-y-auto" role="listbox">
        {sortedScenarios.map((scenario) => (
          <ScenarioListItem
            key={scenario.slug}
            scenario={scenario}
            selected={selectedScenario === scenario.slug}
            onSelect={() => onSelect(scenario.slug)}
          />
        ))}
      </ul>
    </div>
  );
};
```

### Relative Time Formatting
```typescript
// packages/ux/src/lib/formatRelativeTime.ts
export function formatRelativeTime(isoTimestamp: string | null): string {
  if (!isoTimestamp) return 'Never';

  const date = new Date(isoTimestamp);
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffSecs = Math.floor(diffMs / 1000);
  const diffMins = Math.floor(diffSecs / 60);
  const diffHours = Math.floor(diffMins / 60);
  const diffDays = Math.floor(diffHours / 24);

  if (diffSecs < 60) return 'Just now';
  if (diffMins < 60) return `${diffMins}m ago`;
  if (diffHours < 24) return `${diffHours}h ago`;
  if (diffDays === 1) return 'Yesterday';
  if (diffDays < 7) return `${diffDays}d ago`;
  return date.toLocaleDateString();
}
```

### TagChip Component
```typescript
// packages/ux/src/components/common/TagChip.tsx
interface TagChipProps {
  tag: string;
  size?: 'sm' | 'md';
}

export const TagChip: FC<TagChipProps> = ({ tag, size = 'sm' }) => {
  const sizeClasses = {
    sm: 'px-1.5 py-0.5 text-xs',
    md: 'px-2 py-1 text-sm',
  };

  return (
    <span
      className={`
        ${sizeClasses[size]}
        bg-gray-700 text-gray-300 rounded-full
        font-medium
      `}
    >
      {tag}
    </span>
  );
};
```

### Integration with App.tsx
```typescript
// Update in App.tsx
import { useScenarios } from '@/hooks';
import { ScenarioListPanel } from '@/components/panels/ScenarioListPanel';

const AppContent: FC = () => {
  const { projects, loading: projectsLoading, error: projectsError } = useProjects('.');
  const [selectedProject, setSelectedProject] = useState<string | null>(null);
  const [selectedScenario, setSelectedScenario] = useState<string | null>(null);

  // Get scenarios for selected project
  const {
    scenarios,
    loading: scenariosLoading,
    error: scenariosError,
  } = useScenarios(selectedProject || '');

  // Clear scenario selection when project changes
  const handleProjectSelect = (projectPath: string) => {
    setSelectedProject(projectPath);
    setSelectedScenario(null);
  };

  return (
    <ThreeColumnLayout
      middlePanel={
        selectedProject ? (
          <ScenarioListPanel
            scenarios={scenarios}
            selectedScenario={selectedScenario}
            onSelect={setSelectedScenario}
            loading={scenariosLoading}
            error={scenariosError}
          />
        ) : (
          <EmptyState
            icon={<DocumentIcon />}
            title="Select a project"
            description="Choose a project to view its scenarios"
          />
        )
      }
    />
  );
};
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 1.0 | Initial story draft | SM Agent |
