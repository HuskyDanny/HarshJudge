# Story 3.5: Implement Project List Panel

## Status

Done

## Story

**As a** dashboard user,
**I want** to see all my projects with status indicators,
**so that** I can quickly identify which projects need attention.

## Acceptance Criteria

1. Panel displays list of discovered projects from file system
2. Each project shows: name, scenario count, overall status indicator
3. Status indicator: green (all pass), red (any fail), gray (never run)
4. Projects sorted alphabetically by name
5. Clicking project selects it and populates Scenario List
6. Selected project visually highlighted
7. Empty state: "No HarshJudge projects found" with setup hint
8. Panel header shows total project count

## Tasks / Subtasks

- [x] Task 1: Create StatusBadge component (AC: 3)
  - [x] Create `src/components/common/StatusBadge.tsx`
  - [x] Support variants: pass (green), fail (red), never_run (gray)
  - [x] Add aria-label for accessibility
  - [x] Export from common/index.ts

- [x] Task 2: Create ProjectListPanel component (AC: 1, 2, 4, 5, 6, 7, 8)
  - [x] Create `src/components/panels/ProjectListPanel.tsx`
  - [x] Accept props: projects, selectedProject, onSelect, loading, error
  - [x] Display panel header with project count
  - [x] Render project list items with name, scenario count, status
  - [x] Sort projects alphabetically by name
  - [x] Handle selection and highlight selected project
  - [x] Show EmptyState when no projects

- [x] Task 3: Integrate with useProjects hook (AC: 1)
  - [x] Update App.tsx to use useProjects hook
  - [x] Pass real project data to ProjectListPanel
  - [x] Handle loading and error states

- [x] Task 4: Add keyboard navigation (AC: 5)
  - [x] Native keyboard support via Enter/Space key handlers
  - [x] tabIndex on list items for focus management

- [x] Task 5: Connect file watcher for live updates (AC: 1)
  - [x] Wrap App in FileWatcherProvider
  - [x] Projects auto-refresh when files change

- [x] Task 6: Write tests (AC: all)
  - [x] Create `tests/components/ProjectListPanel.test.tsx` (19 tests)
  - [x] Create `tests/components/StatusBadge.test.tsx` (18 tests)
  - [x] Test empty state rendering
  - [x] Test project list rendering
  - [x] Test selection highlighting
  - [x] Test alphabetical sorting

## Dev Notes

### Previous Story Insights
- Story 3.4 created placeholder ProjectListPlaceholder in App.tsx
- useProjects hook already implemented (Story 3.2)
- EmptyState component available (Story 3.4)
- useKeyboardNavigation hook available (Story 3.4)
- FileWatcherContext available (Story 3.3)

### Component Architecture
[Source: architecture/9-frontend-architecture.md]

```typescript
// packages/ux/src/components/panels/ProjectListPanel.tsx
import { type FC } from 'react';
import { type ProjectSummary } from '@/services/DataService';
import { StatusBadge } from '../common/StatusBadge';
import { EmptyState, FolderIcon } from '../common/EmptyState';

interface ProjectListPanelProps {
  projects: ProjectSummary[];
  selectedProject: string | null;
  onSelect: (projectPath: string) => void;
  loading?: boolean;
  error?: string | null;
}

export const ProjectListPanel: FC<ProjectListPanelProps> = ({
  projects,
  selectedProject,
  onSelect,
  loading,
  error,
}) => {
  // Sort alphabetically
  const sortedProjects = [...projects].sort((a, b) =>
    a.name.localeCompare(b.name)
  );

  if (loading) {
    return <LoadingSpinner />;
  }

  if (error) {
    return <EmptyState title="Error" description={error} />;
  }

  if (projects.length === 0) {
    return (
      <EmptyState
        icon={<FolderIcon />}
        title="No projects found"
        description="Initialize a project with /harshjudge:setup"
      />
    );
  }

  return (
    <div className="flex flex-col h-full">
      <header className="p-3 border-b border-gray-700">
        <h2 className="text-sm font-medium text-gray-400">
          Projects ({projects.length})
        </h2>
      </header>
      <ul className="flex-1 overflow-y-auto" role="listbox">
        {sortedProjects.map((project) => (
          <li
            key={project.path}
            role="option"
            aria-selected={selectedProject === project.path}
            className={`
              p-3 cursor-pointer border-b border-gray-800
              hover:bg-gray-800
              ${selectedProject === project.path ? 'bg-gray-800' : ''}
            `}
            onClick={() => onSelect(project.path)}
          >
            <div className="flex items-center justify-between">
              <span className="text-sm font-medium">{project.name}</span>
              <StatusBadge status={project.overallStatus} />
            </div>
            <span className="text-xs text-gray-500">
              {project.scenarioCount} scenarios
            </span>
          </li>
        ))}
      </ul>
    </div>
  );
};
```

### StatusBadge Component
```typescript
// packages/ux/src/components/common/StatusBadge.tsx
interface StatusBadgeProps {
  status: 'pass' | 'fail' | 'never_run';
  size?: 'sm' | 'md';
}

export const StatusBadge: FC<StatusBadgeProps> = ({ status, size = 'sm' }) => {
  const colors = {
    pass: 'bg-green-500',
    fail: 'bg-red-500',
    never_run: 'bg-gray-500',
  };

  const labels = {
    pass: 'All tests passing',
    fail: 'Some tests failing',
    never_run: 'Never run',
  };

  const sizeClasses = {
    sm: 'w-2 h-2',
    md: 'w-3 h-3',
  };

  return (
    <span
      className={`${colors[status]} ${sizeClasses[size]} rounded-full`}
      aria-label={labels[status]}
      title={labels[status]}
    />
  );
};
```

### ProjectSummary Type
[Source: Story 3.2 - DataService.ts]

```typescript
interface ProjectSummary {
  path: string;
  name: string;
  scenarioCount: number;
  overallStatus: 'pass' | 'fail' | 'never_run';
}
```

### Integration with App.tsx
```typescript
// App.tsx - Replace placeholder with real component
import { useProjects } from '@/hooks';
import { ProjectListPanel } from '@/components/panels/ProjectListPanel';
import { FileWatcherProvider } from '@/contexts/FileWatcherContext';

export const App: FC = () => {
  const { projects, loading, error } = useProjects('.');
  const [selectedProject, setSelectedProject] = useState<string | null>(null);

  return (
    <FileWatcherProvider basePath=".">
      <div className="flex flex-col h-screen">
        <Header />
        <main className="flex-1 overflow-hidden">
          <ThreeColumnLayout
            leftPanel={
              <ProjectListPanel
                projects={projects}
                selectedProject={selectedProject}
                onSelect={setSelectedProject}
                loading={loading}
                error={error}
              />
            }
            middlePanel={...}
            rightPanel={...}
          />
        </main>
      </div>
    </FileWatcherProvider>
  );
};
```

### Testing Strategy
```typescript
// tests/components/ProjectListPanel.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { ProjectListPanel } from '../../src/components/panels/ProjectListPanel';

describe('ProjectListPanel', () => {
  const mockProjects = [
    { path: '/a', name: 'Zebra', scenarioCount: 2, overallStatus: 'pass' },
    { path: '/b', name: 'Alpha', scenarioCount: 3, overallStatus: 'fail' },
  ];

  it('renders empty state when no projects', () => {
    render(<ProjectListPanel projects={[]} selectedProject={null} onSelect={() => {}} />);
    expect(screen.getByText('No projects found')).toBeInTheDocument();
  });

  it('sorts projects alphabetically', () => {
    render(<ProjectListPanel projects={mockProjects} selectedProject={null} onSelect={() => {}} />);
    const items = screen.getAllByRole('option');
    expect(items[0]).toHaveTextContent('Alpha');
    expect(items[1]).toHaveTextContent('Zebra');
  });

  it('highlights selected project', () => {
    render(<ProjectListPanel projects={mockProjects} selectedProject="/b" onSelect={() => {}} />);
    expect(screen.getByText('Alpha').closest('li')).toHaveClass('bg-gray-800');
  });

  it('calls onSelect when project clicked', () => {
    const onSelect = vi.fn();
    render(<ProjectListPanel projects={mockProjects} selectedProject={null} onSelect={onSelect} />);
    fireEvent.click(screen.getByText('Alpha'));
    expect(onSelect).toHaveBeenCalledWith('/b');
  });
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 1.0 | Initial story draft | SM Agent |
