# Story 2.1: Implement Main Skill Definition

## Status

Done

## Story

**As a** Claude Code user,
**I want** a YAML-structured main skill file that defines HarshJudge capabilities,
**so that** Claude understands how to use HarshJudge tools with deterministic behavior.

## Acceptance Criteria

1. `skills/harshjudge/skill.yaml` populated with complete skill definition
2. Activation section defines keyword triggers and slash commands
3. Commands section maps each command to corresponding task file
4. Prerequisites section documents required MCP servers with validation hints
5. Principles section defines core principles with IDs for reference
6. Dependencies section lists all tasks, templates, checklists, and data files
7. Skill follows BMAD-like activation pattern (read YAML, adopt persona, await commands)

## Technical References

- **Architecture:** `docs/architecture/appendix-a-claude-skill-templates.md` (A.2 Main Skill Definition)
- **Project Structure:** `docs/architecture/11-unified-project-structure.md`
- **MCP Tools:** `docs/architecture/5-api-specification-mcp-tools.md`

## Tasks / Subtasks

- [ ] **Task 1: Populate skill metadata section** (AC: 1)
  - [ ] Set `skill.name` to "HarshJudge"
  - [ ] Set `skill.id` to "harshjudge"
  - [ ] Set `skill.version` to "1.0"
  - [ ] Set `skill.description` to "AI-native E2E testing orchestration for Claude Code"

- [ ] **Task 2: Define activation triggers** (AC: 2)
  - [ ] Add `activation.keywords` array:
    - "harshjudge"
    - "harsh judge"
    - "e2e test"
    - "end to end test"
  - [ ] Add `activation.commands` array:
    - "/harshjudge:setup"
    - "/harshjudge:analyze"
    - "/harshjudge:create"
    - "/harshjudge:run"
    - "/harshjudge:status"

- [ ] **Task 3: Define command-to-task mappings** (AC: 3)
  - [ ] Add `commands` section mapping each command to task file:
    ```yaml
    commands:
      - setup: Execute task setup-project.md
      - analyze: Execute task analyze-project.md
      - create: Execute task create-scenario.md
      - run: Execute task run-scenario.md
      - status: Execute task check-status.md
    ```

- [ ] **Task 4: Document MCP server prerequisites** (AC: 4)
  - [ ] Add `prerequisites.mcpServers` array with HarshJudge server:
    - name: "@harshjudge/mcp-server"
    - required: true
    - tools: [initProject, saveScenario, startRun, recordEvidence, completeRun, getStatus]
  - [ ] Add Playwright MCP server:
    - name: "playwright"
    - required: true
    - tools: [browser_navigate, browser_click, browser_type, browser_snapshot, browser_take_screenshot, browser_console_messages]

- [ ] **Task 5: Define core principles with IDs** (AC: 5)
  - [ ] Add `principles` array with 5 principles:
    ```yaml
    principles:
      - id: evidence-first
        name: Evidence First
        rule: Always capture screenshots before and after actions
      - id: fail-fast
        name: Fail Fast
        rule: Stop on first failure, capture all diagnostics
      - id: complete-runs
        name: Complete Runs
        rule: Always call completeRun, even on failure
      - id: human-readable
        name: Human-Readable
        rule: Scenarios are Markdown, readable by anyone
      - id: state-tracked
        name: State Tracked
        rule: Update skill-state.yaml after each step for recoverability
    ```

- [ ] **Task 6: Define dependencies** (AC: 6)
  - [ ] Add `dependencies.tasks` listing all task files
  - [ ] Add `dependencies.templates` listing all template files
  - [ ] Add `dependencies.checklists` listing all checklist files
  - [ ] Add `dependencies.data` listing all data files
  - [ ] Verify all listed files exist (created in Story 2.0)

- [ ] **Task 7: Validate YAML syntax and structure** (AC: 1, 7)
  - [ ] Run YAML linter on skill.yaml
  - [ ] Verify structure matches Appendix A.2 template
  - [ ] Ensure no duplicate keys or invalid YAML syntax

## Dev Notes

### BMAD-like Activation Pattern (AC: 7)
[Source: architecture/appendix-a-claude-skill-templates.md#A.1]

The skill follows this activation pattern:
1. Claude reads `skill.yaml` when activated by keywords/commands
2. Claude adopts the HarshJudge persona based on skill definition
3. Claude awaits specific commands before executing tasks
4. On command, Claude loads only the required task file (context-minimized)
5. Claude executes task workflow with state tracking

### Complete skill.yaml Template
[Source: architecture/appendix-a-claude-skill-templates.md#A.2]

```yaml
# HarshJudge Skill Definition
skill:
  name: HarshJudge
  id: harshjudge
  version: "1.0"
  description: AI-native E2E testing orchestration for Claude Code

activation:
  keywords:
    - "harshjudge"
    - "harsh judge"
    - "e2e test"
    - "end to end test"
  commands:
    - "/harshjudge:setup"
    - "/harshjudge:analyze"
    - "/harshjudge:create"
    - "/harshjudge:run"
    - "/harshjudge:status"

prerequisites:
  mcpServers:
    - name: "@harshjudge/mcp-server"
      required: true
      tools:
        - initProject
        - saveScenario
        - startRun
        - recordEvidence
        - completeRun
        - getStatus
    - name: "playwright"
      required: true
      tools:
        - browser_navigate
        - browser_click
        - browser_type
        - browser_snapshot
        - browser_take_screenshot
        - browser_console_messages

commands:
  - setup: Execute task setup-project.md
  - analyze: Execute task analyze-project.md
  - create: Execute task create-scenario.md
  - run: Execute task run-scenario.md
  - status: Execute task check-status.md

principles:
  - id: evidence-first
    name: Evidence First
    rule: Always capture screenshots before and after actions
  - id: fail-fast
    name: Fail Fast
    rule: Stop on first failure, capture all diagnostics
  - id: complete-runs
    name: Complete Runs
    rule: Always call completeRun, even on failure
  - id: human-readable
    name: Human-Readable
    rule: Scenarios are Markdown, readable by anyone
  - id: state-tracked
    name: State Tracked
    rule: Update skill-state.yaml after each step for recoverability

dependencies:
  tasks:
    - setup-project.md
    - analyze-project.md
    - create-scenario.md
    - run-scenario.md
    - check-status.md
  templates:
    - scenario-tmpl.yaml
    - analysis-output-tmpl.md
    - status-output-tmpl.md
  checklists:
    - setup-checklist.md
    - scenario-checklist.md
    - pre-run-checklist.md
    - evidence-checklist.md
  data:
    - evidence-types.md
    - error-protocols.md
```

### MCP Tools Reference
[Source: architecture/5-api-specification-mcp-tools.md#51-mcp-tool-schemas]

| Tool | Description |
|------|-------------|
| `initProject` | Initialize a HarshJudge project in the current directory |
| `saveScenario` | Save a test scenario to the filesystem |
| `startRun` | Start a new test run for a scenario |
| `recordEvidence` | Record test evidence (screenshot, log, db snapshot) |
| `completeRun` | Complete a test run with final results |
| `getStatus` | Get status of all scenarios or a specific scenario |

### Prerequisite: Story 2.0

This story assumes Story 2.0 has been completed, creating:
- Directory structure: `skills/harshjudge/{tasks,templates,checklists,data}/`
- Skeleton `skill.yaml` with structure (this story populates it fully)
- All placeholder files in subdirectories

## Dependencies

- **Blocked by:** Story 2.0 (core structure must exist)
- **Blocks:** Stories 2.2-2.6 (depend on skill.yaml for command definitions)

## Definition of Done

- [ ] `skill.yaml` contains all sections per Appendix A.2
- [ ] YAML syntax is valid (no linting errors)
- [ ] All dependencies listed in skill.yaml exist as files
- [ ] Activation keywords and commands are correctly defined
- [ ] Principles include the new "state-tracked" principle

## Testing

### Testing Requirements

Skill files are YAML configuration and do not require unit tests. Validation is:

1. **YAML Validation:**
   - File parses without errors
   - Structure matches expected schema

2. **Manual Verification:**
   - All sections present and populated
   - All referenced files exist
   - All MCP tools listed correctly

3. **Integration Verification (Optional):**
   - Load skill in Claude Code
   - Verify activation triggers work
   - Verify commands are recognized

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-05 | 1.0 | Initial story draft (markdown-based skill.md) | SM Agent (Bob) |
| 2025-12-05 | 2.0 | Regenerated for YAML-structured skill.yaml per Sprint Change Proposal | SM Agent (Bob) |

---

## Dev Agent Record

**Implementation Date:** 2025-12-05

**Files Modified:**
- `skills/harshjudge/skill.yaml` - Already fully populated during Story 2.0 implementation

**Implementation Details:**

Story 2.1's requirements were fulfilled as part of Story 2.0 implementation. The skill.yaml file was created with complete content matching the Appendix A.2 template exactly:

1. **Skill Metadata (AC 1):** ✅
   - name: HarshJudge
   - id: harshjudge
   - version: "1.0"
   - description: AI-native E2E testing orchestration for Claude Code

2. **Activation Section (AC 2):** ✅
   - 4 keywords: harshjudge, harsh judge, e2e test, end to end test
   - 5 commands: /harshjudge:setup, analyze, create, run, status

3. **Commands Section (AC 3):** ✅
   - All 5 commands mapped to task files

4. **Prerequisites Section (AC 4):** ✅
   - @harshjudge/mcp-server with 6 tools
   - playwright with 6 tools

5. **Principles Section (AC 5):** ✅
   - 5 principles with IDs: evidence-first, fail-fast, complete-runs, human-readable, state-tracked

6. **Dependencies Section (AC 6):** ✅
   - 5 tasks, 3 templates, 4 checklists, 2 data files listed

7. **BMAD-like Pattern (AC 7):** ✅
   - YAML structure enables: read → adopt persona → await commands → load task

**Verification:**
- YAML lint: PASSED (`npx yaml-lint`)
- All dependency files exist (verified in Story 2.0)
- Structure matches Appendix A.2 exactly

---

## QA Results

**QA Date:** 2025-12-05
**Status:** PASSED

### Acceptance Criteria Verification

| AC # | Criteria | Status |
|------|----------|--------|
| 1 | skill.yaml populated with complete definition | ✅ PASS |
| 2 | Activation section with keywords and commands | ✅ PASS |
| 3 | Commands section maps to task files | ✅ PASS |
| 4 | Prerequisites with MCP servers and tools | ✅ PASS |
| 5 | Principles with IDs for reference | ✅ PASS |
| 6 | Dependencies lists all file types | ✅ PASS |
| 7 | BMAD-like activation pattern | ✅ PASS |

### Validation Checks

- **YAML Lint:** PASSED
- **Structure Match:** Matches Appendix A.2 template exactly
- **File References:** All 14 dependency files exist

### Notes

- Story 2.1 was effectively completed during Story 2.0 implementation
- skill.yaml contains complete, production-ready content
- YAML structure supports BMAD-like activation pattern
